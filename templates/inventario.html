<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inventario Supermercado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #2a9d8f;
            color: white;
        }
        .export-buttons button {
            margin-right: 10px;
            margin-bottom: 10px;
            padding: 8px 12px;
            border: none;
            background-color: #264653;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }
        .export-buttons button:hover {
            background-color: #21867a;
        }
    </style>
</head>
<body>
    <h1>ðŸ“¦ Inventario del Supermercado</h1>

    <div class="export-buttons">
        <button onclick="exportTableToCSV('dbTable', 'inventario_db.csv')">ðŸ’¾ Exportar DB a CSV</button>
        <button onclick="exportTableToCSV('txtTable', 'inventario_txt.csv')">ðŸ’¾ Exportar TXT a CSV</button>
        <button onclick="exportTableToCSV('jsonTable', 'inventario_json.csv')">ðŸ’¾ Exportar JSON a CSV</button>
        <button onclick="exportTableToCSV('csvTable', 'inventario_csv.csv')">ðŸ’¾ Exportar CSV a CSV</button>
    </div>

    <h2>Base de Datos (SQLite)</h2>
    <table id="dbTable">
        <thead>
            <tr><th>ID</th><th>Nombre</th><th>Cantidad</th><th>Precio ($)</th></tr>
        </thead>
        <tbody>
            {% for producto in productos_db %}
            <tr>
                <td>{{ producto[0] }}</td>
                <td>{{ producto[1] }}</td>
                <td>{{ producto[2] }}</td>
                <td>{{ producto[3] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Archivo TXT</h2>
    <table id="txtTable">
        <thead>
            <tr><th>Nombre</th><th>Cantidad</th><th>Precio ($)</th></tr>
        </thead>
        <tbody>
            {% for producto in productos_txt %}
            <tr>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.cantidad }}</td>
                <td>{{ producto.precio }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Archivo JSON</h2>
    <table id="jsonTable">
        <thead>
            <tr><th>Nombre</th><th>Cantidad</th><th>Precio ($)</th></tr>
        </thead>
        <tbody>
            {% for producto in productos_json %}
            <tr>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.cantidad }}</td>
                <td>{{ producto.precio }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Archivo CSV</h2>
    <table id="csvTable">
        <thead>
            <tr><th>Nombre</th><th>Cantidad</th><th>Precio ($)</th></tr>
        </thead>
        <tbody>
            {% for producto in productos_csv %}
            <tr>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.cantidad }}</td>
                <td>{{ producto.precio }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
    function downloadCSV(csv, filename) {
        const csvFile = new Blob([csv], {type: "text/csv"});
        const downloadLink = document.createElement("a");
        downloadLink.download = filename;
        downloadLink.href = window.URL.createObjectURL(csvFile);
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
        downloadLink.click();
    }

    function exportTableToCSV(tableId, filename) {
        const rows = document.querySelectorAll(`#${tableId} tr`);
        let csv = [];
        rows.forEach(row => {
            const cols = row.querySelectorAll('th, td');
            const rowData = Array.from(cols).map(col => `"${col.textContent}"`);
            csv.push(rowData.join(","));
        });
        downloadCSV(csv.join("\n"), filename);
    }
    </script>
</body>
</html>
